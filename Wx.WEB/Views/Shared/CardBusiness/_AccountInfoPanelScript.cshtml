@using Wx.WEB.Core.ViewModels

@model CardBusinessRule

<script type="text/javascript">

    //绑定用户信息
    BindCustomerInfo = function (customer) {

        if (customer == null) {
            if ($('#CustName').length > 0) {
                $('#CustName').textbox('setValue', '');
                $('#CustBirth').textbox('setValue', '');
                $('#PaperTypeCode').combobox('setValue', '');
                $('#PaperNo').textbox('setValue', '');
                $('#CustSex').combobox('setValue', '');
                $('#CustPhone').textbox('setValue', '');
                $('#CustPost').textbox('setValue', '');
                $('#CustAddr').textbox('setValue', '');
                $('#CustEmail').textbox('setValue', '');
                $('#Remark').textbox('setValue', '');
                $('#CustomerNo').val('');
            }
        }
        else {
            $('#CustName').textbox('setValue', customer.CUSTNAME);
            if (customer.CUSTBIRTH == '' || customer.CUSTBIRTH == null) {
                $('#CustBirth').datebox('setValue', '');
            }
            else {
                if (customer.CUSTBIRTH.length != 8) { $('#CustBirth').datebox('setValue', ''); }
                else {
                    var strBirth = customer.CUSTBIRTH.substr(0, 4) + "-";
                    strBirth += customer.CUSTBIRTH.substr(4, 2) + "-";
                    strBirth += customer.CUSTBIRTH.substr(6, 2);
                    $('#CustBirth').datebox('setValue', strBirth);
                }
            }
            $('#PaperTypeCode').combobox('setValue', customer.PAPERTYPECODE);
            $('#PaperNo').textbox('setValue', customer.PAPERNO);
            $('#CustSex').combobox('setValue', customer.CUSTSEX);
            $('#CustPhone').textbox('setValue', customer.CUSTPHONE);
            $('#CustPost').textbox('setValue', customer.CUSTPOST);
            $('#CustAddr').textbox('setValue', customer.CUSTADDR);
            $('#CustEmail').textbox('setValue', customer.CUSTEMAIL);
            $('#Remark').textbox('setValue', customer.REMARK);
            $('#CustomerNo').val(customer.CUSTOMNO);
        }
    };


    //查询用户信息
    SearchCustomerInfo = function (idInfo, isReadIDCard) {
        if (idInfo == null) return false;
        $.post("@Html.Raw(Url.Action("SearchCustomer","Customer"))", { PaperType: '00', PaperNo: idInfo.paperno }, function (result) {
            //console.log(JSON.stringify(result));
            if (result.Customers && result.Customers.length > 0) {
                if (isReadIDCard) {
                    $('#CustName').textbox('setValue', idInfo.name);
                    $('#CustBirth').datebox('setValue', idInfo.birth);
                    $('#PaperTypeCode').combobox('setValue', '00');
                    $('#PaperNo').textbox('setValue', idInfo.paperno);
                    $('#CustSex').combobox('setValue', idInfo.sex);
                    $('#CustAddr').textbox('setValue', idInfo.addr);
                }
                else {
                    $('#CustName').textbox('setValue', result.Customers[0].CUSTNAME);
                    $('#CustBirth').datebox('setValue', result.Customers[0].CUSTBIRTH);
                    $('#PaperTypeCode').combobox('setValue', result.Customers[0].PAPERTYPECODE);
                    $('#PaperNo').textbox('setValue', result.Customers[0].PAPERNO);
                    $('#CustSex').combobox('setValue', result.Customers[0].CUSTSEX);
                    $('#CustAddr').textbox('setValue', result.Customers[0].CUSTADDR);
                }
                $('#CustPhone').textbox('setValue', result.Customers[0].CUSTPHONE);
                $('#CustPost').textbox('setValue', result.Customers[0].CUSTPOST);
                $('#CustEmail').textbox('setValue', result.Customers[0].CUSTEMAIL);
                $('#Remark').textbox('setValue', result.Customers[0].REMARK);
                $('#CustomerNo').val(result.Customers[0].CUSTOMNO);
            }
            else {
                $('#CustName').textbox('setValue', idInfo.name);
                $('#CustBirth').datebox('setValue', idInfo.birth);
                $('#PaperTypeCode').combobox('setValue', '00');
                $('#PaperNo').textbox('setValue', idInfo.paperno);
                $('#CustSex').combobox('setValue', idInfo.sex);
                $('#CustPhone').textbox('setValue', '');
                $('#CustPost').textbox('setValue', '');
                $('#CustAddr').textbox('setValue', idInfo.addr);
                $('#CustEmail').textbox('setValue', '');
                $('#Remark').textbox('setValue', '');
                $('#CustomerNo').val('');
            }
        });

    }
</script> 